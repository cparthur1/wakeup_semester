<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Inexorable March of Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .mono {
            font-family: 'Roboto Mono', monospace;
        }
        .card {
            background-color: #1f2937; /* gray-800 */
            border: 1px solid #374151; /* gray-700 */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.5rem; /* p-6 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .progress-bar-bg {
            background-color: #374151; /* gray-700 */
        }
        .progress-bar-fg {
            background-color: #ef4444; /* red-500 */
            transition: width 1.5s ease-in-out;
        }
        /* Custom styles for date picker icon */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
        }
        /* Style for the flickering numbers */
        .flicker {
            color: #ef4444; /* red-500 */
            transition: color 0.1s ease-in-out;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <div id="input-section" class="space-y-8">
            <header class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-white">The Inexorable March of Time</h1>
                <p class="text-lg text-gray-400 mt-2">Your semester is slipping away. Quantify the loss.</p>
            </header>

            <div class="card space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="startDate" class="block text-sm font-medium text-gray-300 mb-2">Semester Start Date</label>
                        <input type="date" id="startDate" class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg p-3 focus:ring-2 focus:ring-red-500 focus:outline-none">
                    </div>
                    <div>
                        <label for="endDate" class="block text-sm font-medium text-gray-300 mb-2">Semester End Date</label>
                        <input type="date" id="endDate" class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg p-3 focus:ring-2 focus:ring-red-500 focus:outline-none">
                    </div>
                </div>
                <div id="error-message" class="text-red-400 text-center font-medium hidden"></div>
                <button id="calculateBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                    Confront Reality
                </button>
            </div>
        </div>

        <div id="results-section" class="hidden mt-8 space-y-6">
            <header class="text-center">
                 <h2 class="text-3xl font-bold text-white">The Reckoning</h2>
                 <p id="quote" class="text-gray-400 mt-2 italic"></p>
            </header>
            
            <!-- Time Passed Progress Bar -->
            <div id="progress-bar-card" class="card">
                <h3 class="text-lg font-semibold text-white mb-3">Semester Elapsed</h3>
                <!-- Increased height of progress bar -->
                <div class="w-full progress-bar-bg rounded-full h-10">
                    <div id="progressBar" class="progress-bar-fg h-10 rounded-full text-center text-white text-sm flex items-center justify-center" style="width: 0%;">
                        <span id="progressText" class="font-semibold mono"></span>
                    </div>
                </div>
            </div>

            <!-- Countdown Timer -->
            <div class="card text-center">
                 <h3 id="countdown-title" class="text-lg font-semibold text-white mb-3">Time Remaining Until The End</h3>
                 <div id="countdown" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-white">
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="days" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Days</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="hours" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Hours</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="minutes" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Minutes</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="seconds" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Seconds</div>
                    </div>
                 </div>
            </div>
            
            <!-- Other Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div id="weeks-passed-card" class="card text-center">
                    <h4 class="text-md font-semibold text-gray-400 mb-2">Weeks Passed</h4>
                    <p id="weeksPassed" class="text-3xl font-bold text-white mono">0</p>
                </div>
                <div id="weeks-left-card" class="card text-center">
                    <h4 class="text-md font-semibold text-gray-400 mb-2">Weeks Remaining</h4>
                    <p id="weeksLeft" class="text-3xl font-bold text-red-400 mono">0</p>
                </div>
                 <div id="total-days-card" class="card text-center">
                    <h4 class="text-md font-semibold text-gray-400 mb-2">Semester Duration</h4>
                    <p id="totalDays" class="text-3xl font-bold text-white mono">0</p>
                </div>
            </div>

            <div class="text-center mt-6">
                <button id="resetBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                    Try Again
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const inputSection = document.getElementById('input-section');
        const resultsSection = document.getElementById('results-section');
        const errorMessage = document.getElementById('error-message');
        
        // Results display elements
        const progressBarCard = document.getElementById('progress-bar-card');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        
        const countdownTitle = document.getElementById('countdown-title');
        const daysEl = document.getElementById('days');
        const hoursEl = document.getElementById('hours');
        const minutesEl = document.getElementById('minutes');
        const secondsEl = document.getElementById('seconds');

        const weeksPassedCard = document.getElementById('weeks-passed-card');
        const weeksLeftCard = document.getElementById('weeks-left-card');
        const totalDaysCard = document.getElementById('total-days-card');

        const weeksPassedEl = document.getElementById('weeksPassed');
        const weeksLeftEl = document.getElementById('weeksLeft');
        const totalDaysEl = document.getElementById('totalDays');
        const quoteEl = document.getElementById('quote');

        let countdownInterval;

        const quotes = [
            "The bad news is time flies. The good news is you're the pilot... of a crashing plane.",
            "Time is a created thing. To say 'I don't have time,' is like saying, 'I don't want to'.",
            "Lost time is never found again.",
            "You may delay, but time will not.",
            "Time is what we want most, but what we use worst."
        ];
        
        // --- Cookie Helper Functions ---
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // --- Load from Cookies on Page Load ---
        function loadFromCookies() {
            const savedStartDate = getCookie('semesterStartDate');
            const savedEndDate = getCookie('semesterEndDate');

            if (savedStartDate && savedEndDate) {
                document.getElementById('startDate').value = savedStartDate;
                document.getElementById('endDate').value = savedEndDate;
                handleCalculation();
            }
        }

        document.addEventListener('DOMContentLoaded', loadFromCookies);
        calculateBtn.addEventListener('click', handleCalculation);
        resetBtn.addEventListener('click', handleReset);

        function handleCalculation() {
            const startDateValue = document.getElementById('startDate').value;
            const endDateValue = document.getElementById('endDate').value;

            if (!startDateValue || !endDateValue) {
                showError("Please select both a start and end date.");
                return;
            }

            const startDate = new Date(startDateValue + 'T00:00:00');
            const endDate = new Date(endDateValue + 'T23:59:59');
            const now = new Date();

            if (startDate >= endDate) {
                showError("The end date must be after the start date.");
                return;
            }
            
            hideError();
            setCookie('semesterStartDate', startDateValue, 180);
            setCookie('semesterEndDate', endDateValue, 180);
            
            inputSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');

            const totalDuration = endDate.getTime() - startDate.getTime();
            const totalDays = Math.ceil(totalDuration / (1000 * 60 * 60 * 24));
            totalDaysEl.textContent = totalDays;

            if (now < startDate) {
                // --- PRE-SEMESTER STATE ---
                quoteEl.textContent = `"The beginning is the most important part of the work." - Plato`;
                progressBarCard.classList.add('hidden');
                weeksPassedCard.classList.add('hidden');
                weeksLeftCard.classList.add('hidden');
                totalDaysCard.classList.remove('hidden'); // Ensure this is visible
                
                countdownTitle.textContent = "Semester Begins In";
                
                if (countdownInterval) clearInterval(countdownInterval);
                countdownInterval = setInterval(() => updateCountdown(startDate), 1000);
                updateCountdown(startDate);

            } else if (now > endDate) {
                // --- POST-SEMESTER STATE ---
                showError("This semester has already ended. The dread is over... or has it just begun?");
                inputSection.classList.remove('hidden');
                resultsSection.classList.add('hidden');
                return;

            } else {
                // --- ACTIVE SEMESTER STATE ---
                quoteEl.textContent = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;
                progressBarCard.classList.remove('hidden');
                weeksPassedCard.classList.remove('hidden');
                weeksLeftCard.classList.remove('hidden');
                totalDaysCard.classList.remove('hidden');

                countdownTitle.textContent = "Time Remaining Until The End";

                const elapsedDuration = now.getTime() - startDate.getTime();
                const percentagePassed = (elapsedDuration / totalDuration) * 100;
                const weeksPassed = Math.floor(elapsedDuration / (1000 * 60 * 60 * 24 * 7));
                const weeksLeft = Math.ceil((totalDuration - elapsedDuration) / (1000 * 60 * 60 * 24 * 7));

                updateStaticStats(percentagePassed, weeksPassed, weeksLeft);
                
                if (countdownInterval) clearInterval(countdownInterval);
                countdownInterval = setInterval(() => updateCountdown(endDate), 1000);
                updateCountdown(endDate);
            }
        }

        function updateStaticStats(percentage, passed, left) {
            progressBar.style.width = `${percentage.toFixed(7)}%`;
            progressText.textContent = `${percentage.toFixed(7)}% Gone`;
            weeksPassedEl.textContent = passed;
            weeksLeftEl.textContent = left;
        }

        function flickerElement(el, newValue) {
            if (el.textContent !== newValue) {
                el.textContent = newValue;
                el.classList.add('flicker');
                setTimeout(() => { el.classList.remove('flicker'); }, 150);
            }
        }

        function updateCountdown(targetDate) {
            const now = new Date().getTime();
            const distance = targetDate.getTime() - now;

            if (distance < 0) {
                clearInterval(countdownInterval);
                // Could trigger a re-calculation here if the semester just started.
                handleCalculation(); 
                return;
            }

            const days = String(Math.floor(distance / (1000 * 60 * 60 * 24))).padStart(2, '0');
            const hours = String(Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60))).padStart(2, '0');
            const minutes = String(Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60))).padStart(2, '0');
            const seconds = String(Math.floor((distance % (1000 * 60)) / 1000)).padStart(2, '0');

            flickerElement(daysEl, days);
            flickerElement(hoursEl, hours);
            flickerElement(minutesEl, minutes);
            flickerElement(secondsEl, seconds);
        }

        function handleReset() {
            resultsSection.classList.add('hidden');
            inputSection.classList.remove('hidden');
            if (countdownInterval) clearInterval(countdownInterval);
            
            // Make sure all elements are visible again for the next calculation
            progressBarCard.classList.remove('hidden');
            weeksPassedCard.classList.remove('hidden');
            weeksLeftCard.classList.remove('hidden');
            totalDaysCard.classList.remove('hidden');

            hideError();
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }
    </script>
</body>
</html>
