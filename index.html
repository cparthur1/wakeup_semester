<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Inexorable March of Time</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .mono {
            font-family: 'Roboto Mono', monospace;
        }
        .card {
            background-color: #1f2937; /* gray-800 */
            border: 1px solid #374151; /* gray-700 */
            border-radius: 0.75rem; /* rounded-xl */
            padding: 1.5rem; /* p-6 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .progress-bar-bg {
            background-color: #374151; /* gray-700 */
        }
        .progress-bar-fg {
            background-color: #ef4444; /* red-500 */
            transition: width 1.5s ease-in-out;
        }
        /* Custom styles for date picker icon */
        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(0.8);
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-4xl mx-auto">
        <div id="input-section" class="space-y-8">
            <header class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold text-white">The Inexorable March of Time</h1>
                <p class="text-lg text-gray-400 mt-2">Your semester is slipping away. Quantify the loss.</p>
            </header>

            <div class="card space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="startDate" class="block text-sm font-medium text-gray-300 mb-2">Semester Start Date</label>
                        <input type="date" id="startDate" class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg p-3 focus:ring-2 focus:ring-red-500 focus:outline-none">
                    </div>
                    <div>
                        <label for="endDate" class="block text-sm font-medium text-gray-300 mb-2">Semester End Date</label>
                        <input type="date" id="endDate" class="w-full bg-gray-700 border border-gray-600 text-white rounded-lg p-3 focus:ring-2 focus:ring-red-500 focus:outline-none">
                    </div>
                </div>
                <div id="error-message" class="text-red-400 text-center font-medium hidden"></div>
                <button id="calculateBtn" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out transform hover:scale-105">
                    Confront Reality
                </button>
            </div>
        </div>

        <div id="results-section" class="hidden mt-8 space-y-6">
            <header class="text-center">
                 <h2 class="text-3xl font-bold text-white">The Reckoning</h2>
                 <p id="quote" class="text-gray-400 mt-2 italic"></p>
            </header>
            
            <!-- Time Passed Progress Bar -->
            <div class="card">
                <h3 class="text-lg font-semibold text-white mb-3">Semester Elapsed</h3>
                <div class="w-full progress-bar-bg rounded-full h-6">
                    <div id="progressBar" class="progress-bar-fg h-6 rounded-full text-center text-white text-sm flex items-center justify-center" style="width: 0%;">
                        <span id="progressText"></span>
                    </div>
                </div>
            </div>

            <!-- Countdown Timer -->
            <div class="card text-center">
                 <h3 class="text-lg font-semibold text-white mb-3">Time Remaining Until The End</h3>
                 <div id="countdown" class="grid grid-cols-2 md:grid-cols-4 gap-4 text-white">
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="days" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Days</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="hours" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Hours</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="minutes" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Minutes</div>
                    </div>
                    <div class="bg-gray-700 p-4 rounded-lg">
                        <div id="seconds" class="text-4xl font-bold mono">00</div>
                        <div class="text-sm text-gray-400">Seconds</div>
                    </div>
                 </div>
            </div>
            
            <!-- Other Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="card text-center">
                    <h4 class="text-md font-semibold text-gray-400 mb-2">Weeks Passed</h4>
                    <p id="weeksPassed" class="text-3xl font-bold text-white mono">0</p>
                </div>
                <div class="card text-center">
                    <h4 class="text-md font-semibold text-gray-400 mb-2">Weeks Remaining</h4>
                    <p id="weeksLeft" class="text-3xl font-bold text-red-400 mono">0</p>
                </div>
                 <div class="card text-center">
                    <h4 class="text-md font-semibold text-gray-400 mb-2">Total Days</h4>
                    <p id="totalDays" class="text-3xl font-bold text-white mono">0</p>
                </div>
            </div>

            <div class="text-center mt-6">
                <button id="resetBtn" class="bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300">
                    Calculate Another Doom
                </button>
            </div>
        </div>
    </div>

    <script>
        // DOM Elements
        const calculateBtn = document.getElementById('calculateBtn');
        const resetBtn = document.getElementById('resetBtn');
        const inputSection = document.getElementById('input-section');
        const resultsSection = document.getElementById('results-section');
        const errorMessage = document.getElementById('error-message');
        
        // Stats display elements
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const daysEl = document.getElementById('days');
        const hoursEl = document.getElementById('hours');
        const minutesEl = document.getElementById('minutes');
        const secondsEl = document.getElementById('seconds');
        const weeksPassedEl = document.getElementById('weeksPassed');
        const weeksLeftEl = document.getElementById('weeksLeft');
        const totalDaysEl = document.getElementById('totalDays');
        const quoteEl = document.getElementById('quote');

        let countdownInterval;

        const quotes = [
            "The bad news is time flies. The good news is you're the pilot... of a crashing plane.",
            "Time is a created thing. To say 'I don't have time,' is like saying, 'I don't want to'.",
            "Lost time is never found again.",
            "You may delay, but time will not.",
            "Time is what we want most, but what we use worst."
        ];
        
        // --- Cookie Helper Functions ---
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/; SameSite=Lax";
        }

        function getCookie(name) {
            const nameEQ = name + "=";
            const ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // --- Load from Cookies on Page Load ---
        function loadFromCookies() {
            const savedStartDate = getCookie('semesterStartDate');
            const savedEndDate = getCookie('semesterEndDate');

            if (savedStartDate && savedEndDate) {
                document.getElementById('startDate').value = savedStartDate;
                document.getElementById('endDate').value = savedEndDate;
                // Automatically confront reality if dates are loaded from cookies
                handleCalculation();
            }
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', loadFromCookies);
        calculateBtn.addEventListener('click', handleCalculation);
        resetBtn.addEventListener('click', handleReset);

        function handleCalculation() {
            const startDateValue = document.getElementById('startDate').value;
            const endDateValue = document.getElementById('endDate').value;

            // --- Validation ---
            if (!startDateValue || !endDateValue) {
                showError("Please select both a start and end date.");
                return;
            }

            const startDate = new Date(startDateValue + 'T00:00:00');
            const endDate = new Date(endDateValue + 'T23:59:59');
            const now = new Date();

            if (startDate >= endDate) {
                showError("The end date must be after the start date.");
                return;
            }
            if (now > endDate) {
                showError("This semester has already ended. The dread is over... or has it just begun?");
                return;
            }
            
            hideError();

            // --- Save valid dates to cookies ---
            setCookie('semesterStartDate', startDateValue, 180); // Save for ~6 months
            setCookie('semesterEndDate', endDateValue, 180);
            
            // Show results and hide inputs
            inputSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');
            
            // Set a random quote
            quoteEl.textContent = `"${quotes[Math.floor(Math.random() * quotes.length)]}"`;

            // --- Calculations ---
            const totalDuration = endDate.getTime() - startDate.getTime();
            const elapsedDuration = now.getTime() - startDate.getTime();
            
            // Clamp elapsed duration to be within the semester bounds
            const clampedElapsed = Math.max(0, Math.min(elapsedDuration, totalDuration));

            const percentagePassed = (clampedElapsed / totalDuration) * 100;

            const totalDays = Math.ceil(totalDuration / (1000 * 60 * 60 * 24));
            const weeksPassed = Math.floor(clampedElapsed / (1000 * 60 * 60 * 24 * 7));
            const weeksLeft = Math.ceil((totalDuration - clampedElapsed) / (1000 * 60 * 60 * 24 * 7));

            // --- Update UI ---
            updateStaticStats(percentagePassed, weeksPassed, weeksLeft, totalDays);
            
            // Start the live countdown
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            countdownInterval = setInterval(() => updateCountdown(endDate), 1000);
            updateCountdown(endDate); // Initial call
        }

        function updateStaticStats(percentage, passed, left, total) {
            // Animate progress bar
            progressBar.style.width = `${percentage.toFixed(2)}%`;
            progressText.textContent = `${percentage.toFixed(7)}% Gone`;
            
            weeksPassedEl.textContent = passed;
            weeksLeftEl.textContent = left;
            totalDaysEl.textContent = total;
        }

        function updateCountdown(endDate) {
            const now = new Date().getTime();
            const distance = endDate.getTime() - now;

            if (distance < 0) {
                clearInterval(countdownInterval);
                daysEl.textContent = '00';
                hoursEl.textContent = '00';
                minutesEl.textContent = '00';
                secondsEl.textContent = '00';
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            daysEl.textContent = String(days).padStart(2, '0');
            hoursEl.textContent = String(hours).padStart(2, '0');
            minutesEl.textContent = String(minutes).padStart(2, '0');
            secondsEl.textContent = String(seconds).padStart(2, '0');
        }

        function handleReset() {
            // Hide results and show inputs
            resultsSection.classList.add('hidden');
            inputSection.classList.remove('hidden');

            // Clear the interval
            if (countdownInterval) {
                clearInterval(countdownInterval);
            }
            
            hideError();
        }

        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
        }

        function hideError() {
            errorMessage.classList.add('hidden');
        }
    </script>
</body>
</html>
